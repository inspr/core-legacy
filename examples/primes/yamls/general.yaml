apiVersion: v1
kind: dapp

meta:
  name: primesexample
spec:
  types:
    primes_ct1:
      meta:
        name: "primes_ct1"
      schema: '{"type":"int"}'
    primes_ct2:
      meta:
        name: "primes_ct2"
      schema: '{"type":"int"}'

  channels:
    primesch1:
      meta:
        name: "primesch1"
        reference: ""
        parent: ""
      spec:
        type: "primes_ct1"
        brokerlist:
          - kafka
    primesch2:
      meta:
        name: "primesch2"
        reference: ""
        parent: ""
      spec:
        type: "primes_ct2"
        brokerlist:
          - kafka

  aliases:
    primes.filterinput:
      target: primesch1
    primes.filteroutput:
      target: primesch2
    primes.printerinput:
      target: primesch2

  apps:
    # number generators
    generator:
      meta:
        name: generator
      spec:
        node:
          spec:
            image: gcr.io/insprlabs/inspr/examples/primes/generator:latest
            replicas: 1
            environment:
              MODULE: 300
        boundary:
          output:
            - primesch1

    primes:
      meta:
        name: primes
      spec:
        boundary:
          input:
            - filterinput
            - printerinput
          output:
            - filteroutput

        apps:
          # filters primes
          filter:
            meta:
              name: filter
              reference: ""
              parent: ""
            spec:
              node:
                spec:
                  image: gcr.io/insprlabs/inspr/examples/primes/filter:latest
                  replicas: 2
              boundary:
                input:
                  - filterinput
                output:
                  - filteroutput

          # prints the filtered
          printer:
            meta:
              name: "printer"
              reference: ""
              parent: ""
            spec:
              node:
                meta:
                  name: "printer"
                spec:
                  image: gcr.io/insprlabs/inspr/examples/primes/printer:latest
                  replicas: 1
              boundary:
                input:
                  - printerinput
